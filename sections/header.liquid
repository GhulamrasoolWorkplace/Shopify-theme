{% render 'header-main-menu' %}

{% for block in section.blocks %}
  <div
    class="mega-menu fixed-menu"
    style="display: none;"
    data-menu-for="{{ block.settings.trigger_link | escape }}"
  >
    <ul>
      {% assign submenu = linklists[block.settings.submenu] %}
      {% for sublink in submenu.links %}
        <li><a href="{{ sublink.url }}">{{ sublink.title }}</a></li>
      {% endfor %}
    </ul>
  </div>
{% endfor %}

<style>
  .fixed-menu {
    position: fixed;
    top: 80px;
    left: 0;
    background: white;
    width: 100%;
    z-index: 999;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const items = document.querySelectorAll(".menu-item");

    items.forEach((item) => {
      const title = item.getAttribute("data-title");
      const megaMenu = document.querySelector(`[data-menu-for='${title}']`);

      if (megaMenu) {
        item.addEventListener("mouseenter", () => {
          megaMenu.style.display = "block";
        });

        item.addEventListener("mouseleave", () => {
          megaMenu.style.display = "none";
        });

        megaMenu.addEventListener("mouseenter", () => {
          megaMenu.style.display = "block";
        });

        megaMenu.addEventListener("mouseleave", () => {
          megaMenu.style.display = "none";
        });
      }
    });
  });
</script>
{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main Menu"
    }
  ],
  "blocks": [
    {
      "type": "submenu_block",
      "name": "Submenu Block",
      "settings": [
        {
          "type": "text",
          "id": "trigger_link",
          "label": "Main Menu Link Title (exact match)"
        },
        {
          "type": "link_list",
          "id": "submenu",
          "label": "Submenu"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Header with Mega Menu"
    }
  ]
}
{% endschema %}
